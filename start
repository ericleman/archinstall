#!/bin/bash

PASSWD=$1
DE=$2
VM=$3

if [ -z "$1" ]
  then
    echo "Please provide password"
    read PASSWD
fi

if [ -z "$2" ]
  then
    DE=kde
    echo "Default DE=$DE"
fi

if [ -z "$3" ]
  then
    VM=vmware
    echo "Default VM=$VM"
fi


#sed -i "s%SigLevel = Required DatabaseOptional%SigLevel = Never%g" /etc/pacman.conf
sed -i "s%Required DatabaseOptional%Never%g" /etc/pacman.conf

pacman -Sy --noconfirm git
git clone https://github.com/ericleman/archinstall.git
cd archinstall

sed -i "s%DUMMYPASSWORD%$PASSWD%g" archinstall/creds.json
sed -i "s%DUMMY_DESKTOP%$DE%g" archinstall/config.json
sed -i "s%DUMMY_VIRTUAL_MACHINE%$VM%g" archinstall/config.json

archinstall --config archinstall/config.json --disk-layout archinstall/layout.json --creds archinstall/creds.json
#archinstall --silent --config archinstall/config.json --creds archinstall/creds.json --disk_layout=archinstall/layout.json

# ln -s ~/Laptop/archinstall/archinstall/gnome/personal/home/.local/share/gnome-shell/extensions ~/.local/share/gnome-shell/
